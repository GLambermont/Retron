var retron=function(t){"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function n(t,e,i){return e&&r(t.prototype,e),i&&r(t,i),t}function s(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&h(t,e)}function o(t){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function h(t,e){return(h=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function c(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}!function(t){if(t&&"undefined"!=typeof window){var e=document.createElement("style");e.setAttribute("type","text/css"),e.innerHTML=t,document.head.appendChild(e)}}("[class^=retron-] {\n  box-sizing: border-box;\n}\n\n.retron-renderer {\n  position: relative;\n  overflow: hidden;\n}\n.retron-render-layer {\n  position: absolute;\n  top: 0;\n  left: 0;\n}");var u,p,d=function(){function t(r,n){if(i(this,t),void 0!==r&&"object"!==e(r)&&(isNaN(parseFloat(r))||!isFinite(r)))throw"".concat(r," is not a valid x value for Vector2");if(void 0!==n&&(isNaN(parseFloat(n))||!isFinite(n)))throw"".concat(n," is not a valid y value for Vector2");this.set(r,n)}return n(t,[{key:"convertVectorInput",value:function(i,r){var n={x:0,y:0};return Array.isArray(i)?(n.x=i[0]||0,n.y=i[1]||0):i instanceof t||"object"==e(i)?(n.x=i.x||0,n.y=i.y||0):void 0===r?(n.x=i,n.y=i):(n.x=i,n.y=r),n}},{key:"set",value:function(t,e){var i=this.convertVectorInput(t,e);return this.x=i.x,this.y=i.y,this}},{key:"add",value:function(t,e){var i=this.convertVectorInput(t,e);return this.x+=i.x,this.y+=i.y,this}},{key:"returnAdd",value:function(e,i){var r=this.convertVectorInput(e,i);return new t(this.x+r.x,this.y+r.y)}},{key:"subtract",value:function(t,e){var i=this.convertVectorInput(t,e);return this.x-=i.x,this.y-=i.y,this}},{key:"returnSubtract",value:function(e,i){var r=this.convertVectorInput(e,i);return new t(this.x-r.x,this.y-r.y)}},{key:"scale",value:function(t){return this.x*=t,this.y*=t,this}},{key:"returnScale",value:function(e){return new t(this.x*e,this.y*e)}},{key:"dot",value:function(t,e){var i=this.convertVectorInput(t,e);return this.x*i.x+this.y*i.y}},{key:"distance",value:function(t,e){var i=this.convertVectorInput(t,e);return Math.hypot(i.x-this.x,i.y-this.y)}},{key:"direction",value:function(){return!(arguments.length>0&&void 0!==arguments[0])||arguments[0]?Math.atan2(this.y,this.x):180*Math.atan2(this.y,this.x)/Math.PI}},{key:"magnitude",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"sqrMagnitude",value:function(){return this.x*this.x+this.y*this.y}},{key:"setDirection",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=this.magnitude();return e||(t*=Math.PI/180),this.x=Math.cos(t)*i,this.y=Math.sin(t)*i,this}},{key:"setMagnitude",value:function(t){return this.x=Math.cos(this.direction())*t,this.y=Math.sin(this.direction())*t,this}},{key:"clampMagnitude",value:function(t){return this.magnitude()>=t&&this.setMagnitude(t),this}},{key:"clampX",value:function(t){return this.x>=t&&(this.x=t),this}},{key:"clampY",value:function(t){return this.y>=t&&(this.y=t),this}},{key:"draw",value:function(t,e,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"#00ff00";return t.beginPath(),t.moveTo(e,i),t.lineTo(e+this.x*r,i+this.y*r),t.strokeStyle=n,t.stroke(),this}}]),t}(),l=(s(u={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pauseBreak:19,capsLock:20,esc:27,pageUp:33,pageDown:34,end:35,home:36,arrowLeft:37,arrowUp:38,arrowRight:39,arrowDown:40,printScreen:44,insert:45,delete:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,windowsLeft:91,windowsRight:92,select:93,numpad0:96},"numpad0",97),s(u,"numpad0",98),s(u,"numpad0",99),s(u,"numpad0",100),s(u,"numpad0",101),s(u,"numpad0",102),s(u,"numpad0",103),s(u,"numpad0",104),s(u,"numpad0",105),s(u,"multiply",106),s(u,"add",107),s(u,"subtract",109),s(u,"decimalPoint",110),s(u,"divide",111),s(u,"f1",112),s(u,"f2",113),s(u,"f3",114),s(u,"f4",115),s(u,"f5",116),s(u,"f6",117),s(u,"f7",118),s(u,"f8",119),s(u,"f9",120),s(u,"f10",121),s(u,"f11",122),s(u,"f12",123),s(u,"numLock",144),s(u,"scrollLock",145),s(u,"semiColon",186),s(u,"equal",187),s(u,"comma",188),s(u,"dash",189),s(u,"period",190),s(u,"forwardSlash",191),s(u,"graveAccent",192),s(u,"openBracket",219),s(u,"backSlash",220),s(u,"closeBracket",221),s(u,"singleQuote",222),u),f=function(){function t(){var e=this,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];i(this,t),this.preventDefault=r,this.pressedKeys=new Set,document.addEventListener("keydown",function(t){e.preventDefault&&t.preventDefault(),e.pressedKeys.add(t.keyCode)},!1),document.addEventListener("keyup",function(t){e.preventDefault&&t.preventDefault(),e.pressedKeys.delete(t.keyCode)},!1)}return n(t,[{key:"keyPressed",value:function(t){var e;if("number"==typeof t?e=t:"string"==typeof t&&(e=l[t]),void 0===e)throw new Error("".concat(t," is not a valid key value.\nAll valid key values and corresponding key codes can be accessed from the keyMap object instance."));return this.pressedKeys.has(e)}}]),t}(),m=Symbol("Load images from path"),y=Symbol("Load images from array"),v=Symbol("Load images from object"),g=function(){function t(){i(this,t)}return n(t,[{key:"load",value:function(t){if(void 0===t.paths&&(t.paths=t.path),"string"==typeof t.paths)return this[m](t);if(Array.isArray(t.paths))return this[y](t);if("object"==e(t.paths))return this[v](t);throw new Error("The type for the path or paths property is invalid")}},{key:m,value:function(t){var e=t.path,i=t.attributes,r=void 0===i?{}:i,n=new Image;return new Promise(function(t,i){n.onload=function(){t(n),n.onload=null},n.onerror=function(){i("Image could not be found and loaded from specified path: ".concat(e))},Object.keys(r).map(function(t){n.setAttribute(t,r[t])}),n.src=e})}},{key:y,value:function(t){var e=this,i=t.paths,r=t.attributes,n=t.forEach,s=void 0===n?function(){}:n,a=i.map(function(t){return e.load({path:t,attributes:r}).then(function(t){return s(t),t})});return Promise.all(a)}},{key:v,value:function(t){var e=this,i=t.paths,r=t.attributes,n=t.forEach,s=void 0===n?function(){}:n,a=Object.keys(i),o=a.map(function(t){return e.load({path:i[t],attributes:r}).then(function(t){return s(t),t})}),h={};return Promise.all(o).then(function(t){return t.forEach(function(t,e){h[a[e]]=t}),h})}}]),t}(),w={g:.5},x=Object.freeze({forces:w}),b={static:[],dynamic:[],physics:[],particle:[]},F=function(t){t.velocity.add(t.acceleration),t.position.add(t.velocity),t.acceleration.set(0,0)},k=function(){function t(e){var r=e.width,n=e.height,s=e.position,a=void 0===s?new d(0):s,o=e.rotation,h=void 0===o?0:o,c=e.sprite,u=e.spriteFrameRate,p=void 0===u?16:u,l=e.spriteFrameCount,f=void 0===l?1:l,m=e.spriteFrameWidth,y=void 0===m?c.width:m,v=e.spriteFrameHeight,g=void 0===v?c.height:v,w=e.spriteOrigin,x=void 0===w?{x:0,y:0}:w,F=e.type;i(this,t),this.sprite=c,this.spriteFrameWidth=y,this.spriteFrameHeight=g,this.spriteFrameIndex=0,this.spriteFrameRate=p,this.spriteFrameSkip=Math.round(60/this.spriteFrameRate),this.spriteUpdateCount=0,this.spriteFrameCount=f,this.spriteFramesPerRow=Math.floor(c.width/y),this.spriteRow=0,this.spriteCol=0,this.spriteOrigin=x,this.width=r||this.spriteFrameWidth,this.height=n||this.spriteFrameHeight,this.halfWidth=this.width/2,this.halfHeight=this.height/2,this.position=a,this.rotation=h,b[F].push(this)}return n(t,[{key:"mid",value:function(){return{x:this.position.x+this.halfWidth,y:this.position.y+this.halfHeight}}},{key:"sides",value:function(){return{top:this.position.y,bottom:this.position.y+this.width,left:this.position.x,right:this.position.x+this.height}}},{key:"updateBounds",value:function(){this.halfWidth=this.width/2,this.halfHeight=this.height/2}},{key:"changeSprite",value:function(t,e){t!=this.sprite&&(this.sprite=t,this.spriteFrameIndex=0,this.spriteUpdateCount=0,this.spriteFramesPerRow=Math.floor(t.width/this.width))}},{key:"updateSprite",value:function(){this.spriteUpdateCount===Math.round(60/this.spriteFrameRate)-1&&(this.spriteFrameIndex=(this.spriteFrameIndex+1)%(this.spriteFrameCount-1)),this.spriteUpdateCount=(this.spriteUpdateCount+1)%Math.round(60/this.spriteFrameRate),this.spriteRow=this.spriteFrameIndex/this.spriteFramesPerRow>>>0,this.spriteCol=this.spriteFrameIndex%this.spriteFramesPerRow>>>0}},{key:"draw",value:function(t){this.updateSprite(),t.translate(this.position.x+this.spriteOrigin.x,this.position.y+this.spriteOrigin.y),t.rotate(this.rotation),t.translate(-(this.position.x+this.spriteOrigin.x),-(this.position.y+this.spriteOrigin.y)),t.drawImage(this.sprite,this.spriteCol*this.spriteFrameWidth,this.spriteRow*this.spriteFrameHeight,this.spriteFrameWidth,this.spriteFrameHeight,this.position.x,this.position.y,this.width,this.height),t.resetTransform()}}]),t}(),S=function(t){function e(t){var r=t.sprite,n=t.spriteFrameRate,s=void 0===n?16:n,a=t.spriteFrameCount,h=void 0===a?1:a,u=t.spriteFrameWidth,p=void 0===u?r.width:u,l=t.spriteFrameHeight,f=void 0===l?r.height:l,m=t.width,y=t.height,v=t.position,g=void 0===v?new d(0):v;return i(this,e),c(this,o(e).call(this,{sprite:r,spriteFrameRate:s,spriteFrameCount:h,spriteFrameWidth:p,spriteFrameHeight:f,width:m,height:y,position:g,type:"static"}))}return a(e,k),e}(),R=function(t){function e(t){var r,n=t.sprite,s=t.spriteFrameRate,a=t.spriteFrameCount,h=t.spriteFrameWidth,u=t.spriteFrameHeight,p=t.spriteOrigin,l=t.width,f=t.height,m=t.position,y=t.rotation,v=t.type,g=void 0===v?"dynamic":v;return i(this,e),(r=c(this,o(e).call(this,{width:l,height:f,position:m,rotation:y,sprite:n,spriteFrameRate:s,spriteFrameCount:a,spriteFrameWidth:h,spriteFrameHeight:u,spriteOrigin:p,type:g}))).velocity=new d(0),r.acceleration=new d(0),r}return a(e,k),e}(),O=function(t){function e(t){var r,n=t.width,s=t.height,a=t.position,h=t.rotation,u=t.sprite,p=t.spriteFrameRate,d=t.spriteFrameCount,l=t.spriteFrameWidth,f=t.spriteFrameHeight,m=t.spriteOrigin,y=t.mass,v=void 0===y?1:y,g=t.type,w=void 0===g?"physics":g;return i(this,e),(r=c(this,o(e).call(this,{width:n,height:s,position:a,rotation:h,sprite:u,spriteFrameRate:p,spriteFrameCount:d,spriteFrameWidth:l,spriteFrameHeight:f,spriteOrigin:m,type:w}))).mass=v,r}return a(e,R),e}(),C=function(t){function e(t){var r,n=t.sprite,s=t.lifeTime,a=void 0===s?100:s,h=t.massReduction,u=void 0===h?.1:h,p=t.scaleReduction,d=void 0===p?.1:p,l=t.type,f=void 0===l?"particle":l;return i(this,e),(r=c(this,o(e).call(this,{sprite:n,type:f}))).lifeTime=a,r.massReduction=u,r.scaleReduction=d,r}return a(e,O),n(e,[{key:"draw",value:function(t){t.drawImage(this.sprite,this.position.x-this.halfWidth,this.position.y-this.halfHeight,this.width,this.height)}}]),e}(),M=function(){function t(){var e=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.width,s=void 0===n?640:n,a=r.height,o=void 0===a?360:a,h=r.layers,c=void 0===h?{}:h,u=r.className,p=void 0===u?"":u;i(this,t),this.width=s,this.height=o,this.element=document.createElement("div"),this.element.className="retron-renderer ".concat(p),this.layers=c,Object.values(this.layers).forEach(function(t,i){t.canvas.style.zIndex=i,e.element.appendChild(t.canvas)}),this.setSize(s,o)}return n(t,[{key:"setSize",value:function(t,e){this.width=t,this.height=e,this.element.style.width="".concat(Math.floor(t),"px"),this.element.style.height="".concat(Math.floor(e),"px"),Object.values(this.layers).forEach(function(i,r){i.setSize(t,e)})}}]),t}(),T=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.className,n=void 0===r?"":r,s=e.clearFullFrame,a=void 0===s||s,o=e.ctx,h=void 0===o?"2d":o;i(this,t),this.canvas=document.createElement("canvas"),this.canvas.className="retron-render-layer ".concat(n),this.ctx=this.canvas.getContext(h),this.clearFullFrame=a}return n(t,[{key:"setSize",value:function(t,e){this.canvas.width=t,this.canvas.height=e}},{key:"render",value:function(t){this.clearFullFrame&&this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),t(this.ctx)}}]),t}(),I={timeScale:1,fixedTimeStep:1e3/30,time:0,fixedTime:0,deltaTime:0,fixedDeltaTime:0},j=new Set,P=new Set,H=new Set,E=0,W=0,D=function(t){return t.forEach(function(t){return t()})};return t.constants=x,t.Vector2=d,t.keyMap=l,t.InputManager=f,t.ImageLoader=g,t.StaticObject=S,t.DynamicObject=R,t.PhysicsObject=O,t.SpriteParticle=C,t.Renderer=M,t.RenderLayer=T,t.bodies=b,t.time=I,t.vw=function(t){return window.innerWidth*t/100},t.vh=function(t){return window.innerHeight*t/100},t.cw=function(t,e){return t.width*e/100},t.ch=function(t,e){return t.height*e/100},t.updateTasks=j,t.fixedUpdateTasks=P,t.lateUpdateTasks=H,t.startCoreUpdate=function t(){I.time=Date.now(),I.deltaTime=I.time-E,E=I.time,W=I.time-I.fixedTime,D(j),W>=I.fixedTimeStep&&(I.fixedTime=I.time-I.fixedDeltaTime%I.fixedTimeStep,I.fixedDeltaTime=W,function(){var t=0;for(t=b.dynamic.length;t--;)F(b.dynamic[t]);for(t=b.physics.length;t--;)b.physics[t].acceleration.add(0,w.g*b.physics[t].mass),F(b.physics[t]);for(t=b.particle.length;t--;)b.particle[t].acceleration.add(0,w.g*b[t].mass),F(b.particle[t]),b.particle[t].mass-=b[t].massReduction,b.particle[t].width-=b[t].scaleReduction,b.particle[t].height-=b[t].scaleReduction,b.particle[t].lifeTime-=1,b.particle[t].updateBounds(),(b.particle[t].lifeTime<=0||b.particle[t].width<=0||b.particle[t].height<=0)&&b.particle.splice(t,1)}(),D(P)),D(H),p=requestAnimationFrame(t)},t.stopCoreUpdate=function(){window.cancelAnimationFrame(p)},t}({});
//# sourceMappingURL=retron.iife.min.js.map
