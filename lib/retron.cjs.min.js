"use strict";function ___$insertStyle(e){if(e&&"undefined"!=typeof window){var t=document.createElement("style");return t.setAttribute("type","text/css"),t.innerHTML=e,document.head.appendChild(t),e}}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}Object.defineProperty(exports,"__esModule",{value:!0}),___$insertStyle("[class^=retron-] {\n  box-sizing: border-box;\n}\n\n.retron-renderer {\n  position: relative;\n  overflow: hidden;\n}\n.retron-render-layer {\n  position: absolute;\n  top: 0;\n  left: 0;\n}");var _keyMap,coreUpdateRequestId,Vector2=function(){function e(t,i){if(_classCallCheck(this,e),void 0!==t&&"object"!==_typeof(t)&&(isNaN(parseFloat(t))||!isFinite(t)))throw"".concat(t," is not a valid x value for Vector2");if(void 0!==i&&(isNaN(parseFloat(i))||!isFinite(i)))throw"".concat(i," is not a valid y value for Vector2");this.set(t,i)}return _createClass(e,[{key:"convertVectorInput",value:function(t,i){var r={x:0,y:0};return Array.isArray(t)?(r.x=t[0]||0,r.y=t[1]||0):t instanceof e||"object"==_typeof(t)?(r.x=t.x||0,r.y=t.y||0):void 0===i?(r.x=t,r.y=t):(r.x=t,r.y=i),r}},{key:"set",value:function(e,t){var i=this.convertVectorInput(e,t);return this.x=i.x,this.y=i.y,this}},{key:"add",value:function(e,t){var i=this.convertVectorInput(e,t);return this.x+=i.x,this.y+=i.y,this}},{key:"returnAdd",value:function(t,i){var r=this.convertVectorInput(t,i);return new e(this.x+r.x,this.y+r.y)}},{key:"subtract",value:function(e,t){var i=this.convertVectorInput(e,t);return this.x-=i.x,this.y-=i.y,this}},{key:"returnSubtract",value:function(t,i){var r=this.convertVectorInput(t,i);return new e(this.x-r.x,this.y-r.y)}},{key:"scale",value:function(e){return this.x*=e,this.y*=e,this}},{key:"returnScale",value:function(t){return new e(this.x*t,this.y*t)}},{key:"dot",value:function(e,t){var i=this.convertVectorInput(e,t);return this.x*i.x+this.y*i.y}},{key:"distance",value:function(e,t){var i=this.convertVectorInput(e,t);return Math.hypot(i.x-this.x,i.y-this.y)}},{key:"direction",value:function(){return!(arguments.length>0&&void 0!==arguments[0])||arguments[0]?Math.atan2(this.y,this.x):180*Math.atan2(this.y,this.x)/Math.PI}},{key:"magnitude",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"sqrMagnitude",value:function(){return this.x*this.x+this.y*this.y}},{key:"setDirection",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=this.magnitude();return t||(e*=Math.PI/180),this.x=Math.cos(e)*i,this.y=Math.sin(e)*i,this}},{key:"setMagnitude",value:function(e){return this.x=Math.cos(this.direction())*e,this.y=Math.sin(this.direction())*e,this}},{key:"clampMagnitude",value:function(e){return this.magnitude()>=e&&this.setMagnitude(e),this}},{key:"clampX",value:function(e){return this.x>=e&&(this.x=e),this}},{key:"clampY",value:function(e){return this.y>=e&&(this.y=e),this}},{key:"draw",value:function(e,t,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"#00ff00";return e.beginPath(),e.moveTo(t,i),e.lineTo(t+this.x*r,i+this.y*r),e.strokeStyle=s,e.stroke(),this}}]),e}(),keyMap=(_defineProperty(_keyMap={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pauseBreak:19,capsLock:20,esc:27,pageUp:33,pageDown:34,end:35,home:36,arrowLeft:37,arrowUp:38,arrowRight:39,arrowDown:40,printScreen:44,insert:45,delete:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,windowsLeft:91,windowsRight:92,select:93,numpad0:96},"numpad0",97),_defineProperty(_keyMap,"numpad0",98),_defineProperty(_keyMap,"numpad0",99),_defineProperty(_keyMap,"numpad0",100),_defineProperty(_keyMap,"numpad0",101),_defineProperty(_keyMap,"numpad0",102),_defineProperty(_keyMap,"numpad0",103),_defineProperty(_keyMap,"numpad0",104),_defineProperty(_keyMap,"numpad0",105),_defineProperty(_keyMap,"multiply",106),_defineProperty(_keyMap,"add",107),_defineProperty(_keyMap,"subtract",109),_defineProperty(_keyMap,"decimalPoint",110),_defineProperty(_keyMap,"divide",111),_defineProperty(_keyMap,"f1",112),_defineProperty(_keyMap,"f2",113),_defineProperty(_keyMap,"f3",114),_defineProperty(_keyMap,"f4",115),_defineProperty(_keyMap,"f5",116),_defineProperty(_keyMap,"f6",117),_defineProperty(_keyMap,"f7",118),_defineProperty(_keyMap,"f8",119),_defineProperty(_keyMap,"f9",120),_defineProperty(_keyMap,"f10",121),_defineProperty(_keyMap,"f11",122),_defineProperty(_keyMap,"f12",123),_defineProperty(_keyMap,"numLock",144),_defineProperty(_keyMap,"scrollLock",145),_defineProperty(_keyMap,"semiColon",186),_defineProperty(_keyMap,"equal",187),_defineProperty(_keyMap,"comma",188),_defineProperty(_keyMap,"dash",189),_defineProperty(_keyMap,"period",190),_defineProperty(_keyMap,"forwardSlash",191),_defineProperty(_keyMap,"graveAccent",192),_defineProperty(_keyMap,"openBracket",219),_defineProperty(_keyMap,"backSlash",220),_defineProperty(_keyMap,"closeBracket",221),_defineProperty(_keyMap,"singleQuote",222),_keyMap),InputManager=function(){function e(){var t=this,i=arguments.length>0&&void 0!==arguments[0]&&arguments[0];_classCallCheck(this,e),this.preventDefault=i,this.pressedKeys=new Set,document.addEventListener("keydown",function(e){t.preventDefault&&e.preventDefault(),t.pressedKeys.add(e.keyCode)},!1),document.addEventListener("keyup",function(e){t.preventDefault&&e.preventDefault(),t.pressedKeys.delete(e.keyCode)},!1)}return _createClass(e,[{key:"keyPressed",value:function(e){var t;if("number"==typeof e?t=e:"string"==typeof e&&(t=keyMap[e]),void 0===t)throw new Error("".concat(e," is not a valid key value.\nAll valid key values and corresponding key codes can be accessed from the keyMap object instance."));return this.pressedKeys.has(t)}}]),e}(),loadFromPath=Symbol("Load images from path"),loadFromArray=Symbol("Load images from array"),loadFromObject=Symbol("Load images from object"),ImageLoader=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"load",value:function(e){if(void 0===e.paths&&(e.paths=e.path),"string"==typeof e.paths)return this[loadFromPath](e);if(Array.isArray(e.paths))return this[loadFromArray](e);if("object"==_typeof(e.paths))return this[loadFromObject](e);throw new Error("The type for the path or paths property is invalid")}},{key:loadFromPath,value:function(e){var t=e.path,i=e.attributes,r=void 0===i?{}:i,s=new Image;return new Promise(function(e,i){s.onload=function(){e(s),s.onload=null},s.onerror=function(){i("Image could not be found and loaded from specified path: ".concat(t))},Object.keys(r).map(function(e){s.setAttribute(e,r[e])}),s.src=t})}},{key:loadFromArray,value:function(e){var t=this,i=e.paths,r=e.attributes,s=e.forEach,n=void 0===s?function(){}:s,a=i.map(function(e){return t.load({path:e,attributes:r}).then(function(e){return n(e),e})});return Promise.all(a)}},{key:loadFromObject,value:function(e){var t=this,i=e.paths,r=e.attributes,s=e.forEach,n=void 0===s?function(){}:s,a=Object.keys(i),o=a.map(function(e){return t.load({path:i[e],attributes:r}).then(function(e){return n(e),e})}),p={};return Promise.all(o).then(function(e){return e.forEach(function(e,t){p[a[t]]=e}),p})}}]),e}(),forces={g:.5},_constants=Object.freeze({forces:forces}),bodies={static:[],dynamic:[],physics:[],particle:[]},updateForces=function(e){e.velocity.add(e.acceleration),e.position.add(e.velocity),e.acceleration.set(0,0)},updateBodies=function(){var e=0;for(e=bodies.dynamic.length;e--;)updateForces(bodies.dynamic[e]);for(e=bodies.physics.length;e--;)bodies.physics[e].acceleration.add(0,forces.g*bodies.physics[e].mass),updateForces(bodies.physics[e]);for(e=bodies.particle.length;e--;)bodies.particle[e].acceleration.add(0,forces.g*bodies[e].mass),updateForces(bodies.particle[e]),bodies.particle[e].mass-=bodies[e].massReduction,bodies.particle[e].width-=bodies[e].scaleReduction,bodies.particle[e].height-=bodies[e].scaleReduction,bodies.particle[e].lifeTime-=1,bodies.particle[e].updateBounds(),(bodies.particle[e].lifeTime<=0||bodies.particle[e].width<=0||bodies.particle[e].height<=0)&&bodies.particle.splice(e,1)},GameObject=function(){function e(t){var i=t.width,r=t.height,s=t.position,n=void 0===s?new Vector2(0):s,a=t.rotation,o=void 0===a?0:a,p=t.sprite,h=t.spriteFrameRate,c=void 0===h?16:h,d=t.spriteFrameCount,u=void 0===d?1:d,l=t.spriteFrameWidth,y=void 0===l?p.width:l,f=t.spriteFrameHeight,m=void 0===f?p.height:f,v=t.spriteOrigin,_=void 0===v?{x:0,y:0}:v,k=t.type;_classCallCheck(this,e),this.sprite=p,this.spriteFrameWidth=y,this.spriteFrameHeight=m,this.spriteFrameIndex=0,this.spriteFrameRate=c,this.spriteFrameSkip=Math.round(60/this.spriteFrameRate),this.spriteUpdateCount=0,this.spriteFrameCount=u,this.spriteFramesPerRow=Math.floor(p.width/y),this.spriteRow=0,this.spriteCol=0,this.spriteOrigin=_,this.width=i||this.spriteFrameWidth,this.height=r||this.spriteFrameHeight,this.halfWidth=this.width/2,this.halfHeight=this.height/2,this.position=n,this.rotation=o,bodies[k].push(this)}return _createClass(e,[{key:"mid",value:function(){return{x:this.position.x+this.halfWidth,y:this.position.y+this.halfHeight}}},{key:"sides",value:function(){return{top:this.position.y,bottom:this.position.y+this.width,left:this.position.x,right:this.position.x+this.height}}},{key:"updateBounds",value:function(){this.halfWidth=this.width/2,this.halfHeight=this.height/2}},{key:"changeSprite",value:function(e,t){e!=this.sprite&&(this.sprite=e,this.spriteFrameIndex=0,this.spriteUpdateCount=0,this.spriteFramesPerRow=Math.floor(e.width/this.width))}},{key:"updateSprite",value:function(){this.spriteUpdateCount===Math.round(60/this.spriteFrameRate)-1&&(this.spriteFrameIndex=(this.spriteFrameIndex+1)%(this.spriteFrameCount-1)),this.spriteUpdateCount=(this.spriteUpdateCount+1)%Math.round(60/this.spriteFrameRate),this.spriteRow=this.spriteFrameIndex/this.spriteFramesPerRow>>>0,this.spriteCol=this.spriteFrameIndex%this.spriteFramesPerRow>>>0}},{key:"draw",value:function(e){this.updateSprite(),e.translate(this.position.x+this.spriteOrigin.x,this.position.y+this.spriteOrigin.y),e.rotate(this.rotation),e.translate(-(this.position.x+this.spriteOrigin.x),-(this.position.y+this.spriteOrigin.y)),e.drawImage(this.sprite,this.spriteCol*this.spriteFrameWidth,this.spriteRow*this.spriteFrameHeight,this.spriteFrameWidth,this.spriteFrameHeight,this.position.x,this.position.y,this.width,this.height),e.resetTransform()}}]),e}(),StaticObject=function(e){function t(e){var i=e.sprite,r=e.spriteFrameRate,s=void 0===r?16:r,n=e.spriteFrameCount,a=void 0===n?1:n,o=e.spriteFrameWidth,p=void 0===o?i.width:o,h=e.spriteFrameHeight,c=void 0===h?i.height:h,d=e.width,u=e.height,l=e.position,y=void 0===l?new Vector2(0):l;return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,{sprite:i,spriteFrameRate:s,spriteFrameCount:a,spriteFrameWidth:p,spriteFrameHeight:c,width:d,height:u,position:y,type:"static"}))}return _inherits(t,GameObject),t}(),DynamicObject=function(e){function t(e){var i,r=e.sprite,s=e.spriteFrameRate,n=e.spriteFrameCount,a=e.spriteFrameWidth,o=e.spriteFrameHeight,p=e.spriteOrigin,h=e.width,c=e.height,d=e.position,u=e.rotation,l=e.type,y=void 0===l?"dynamic":l;return _classCallCheck(this,t),(i=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,{width:h,height:c,position:d,rotation:u,sprite:r,spriteFrameRate:s,spriteFrameCount:n,spriteFrameWidth:a,spriteFrameHeight:o,spriteOrigin:p,type:y}))).velocity=new Vector2(0),i.acceleration=new Vector2(0),i}return _inherits(t,GameObject),t}(),PhysicsObject=function(e){function t(e){var i,r=e.width,s=e.height,n=e.position,a=e.rotation,o=e.sprite,p=e.spriteFrameRate,h=e.spriteFrameCount,c=e.spriteFrameWidth,d=e.spriteFrameHeight,u=e.spriteOrigin,l=e.mass,y=void 0===l?1:l,f=e.type,m=void 0===f?"physics":f;return _classCallCheck(this,t),(i=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,{width:r,height:s,position:n,rotation:a,sprite:o,spriteFrameRate:p,spriteFrameCount:h,spriteFrameWidth:c,spriteFrameHeight:d,spriteOrigin:u,type:m}))).mass=y,i}return _inherits(t,DynamicObject),t}(),SpriteParticle=function(e){function t(e){var i,r=e.sprite,s=e.lifeTime,n=void 0===s?100:s,a=e.massReduction,o=void 0===a?.1:a,p=e.scaleReduction,h=void 0===p?.1:p,c=e.type,d=void 0===c?"particle":c;return _classCallCheck(this,t),(i=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,{sprite:r,type:d}))).lifeTime=n,i.massReduction=o,i.scaleReduction=h,i}return _inherits(t,PhysicsObject),_createClass(t,[{key:"draw",value:function(e){e.drawImage(this.sprite,this.position.x-this.halfWidth,this.position.y-this.halfHeight,this.width,this.height)}}]),t}(),Renderer=function(){function e(){var t=this,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=i.width,s=void 0===r?640:r,n=i.height,a=void 0===n?360:n,o=i.layers,p=void 0===o?{}:o,h=i.className,c=void 0===h?"":h;_classCallCheck(this,e),this.width=s,this.height=a,this.element=document.createElement("div"),this.element.className="retron-renderer ".concat(c),this.layers=p,Object.values(this.layers).forEach(function(e,i){e.canvas.style.zIndex=i,t.element.appendChild(e.canvas)}),this.setSize(s,a)}return _createClass(e,[{key:"setSize",value:function(e,t){this.width=e,this.height=t,this.element.style.width="".concat(Math.floor(e),"px"),this.element.style.height="".concat(Math.floor(t),"px"),Object.values(this.layers).forEach(function(i,r){i.setSize(e,t)})}}]),e}(),RenderLayer=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=t.className,r=void 0===i?"":i,s=t.clearFullFrame,n=void 0===s||s,a=t.ctx,o=void 0===a?"2d":a;_classCallCheck(this,e),this.canvas=document.createElement("canvas"),this.canvas.className="retron-render-layer ".concat(r),this.ctx=this.canvas.getContext(o),this.clearFullFrame=n}return _createClass(e,[{key:"setSize",value:function(e,t){this.canvas.width=e,this.canvas.height=t}},{key:"render",value:function(e){this.clearFullFrame&&this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),e(this.ctx)}}]),e}(),vw=function(e){return window.innerWidth*e/100},vh=function(e){return window.innerHeight*e/100},cw=function(e,t){return e.width*t/100},ch=function(e,t){return e.height*t/100},time={timeScale:1,fixedTimeStep:1e3/30,time:0,fixedTime:0,deltaTime:0,fixedDeltaTime:0},updateTasks=new Set,fixedUpdateTasks=new Set,lateUpdateTasks=new Set,lastTime=0,fixedTimeElapsed=0,runUpdateTasks=function(e){return e.forEach(function(e){return e()})},coreUpdate=function e(){time.time=Date.now(),time.deltaTime=time.time-lastTime,lastTime=time.time,fixedTimeElapsed=time.time-time.fixedTime,runUpdateTasks(updateTasks),fixedTimeElapsed>=time.fixedTimeStep&&(time.fixedTime=time.time-time.fixedDeltaTime%time.fixedTimeStep,time.fixedDeltaTime=fixedTimeElapsed,updateBodies(),runUpdateTasks(fixedUpdateTasks)),runUpdateTasks(lateUpdateTasks),coreUpdateRequestId=requestAnimationFrame(e)},stopCoreUpdate=function(){window.cancelAnimationFrame(coreUpdateRequestId)};exports.constants=_constants,exports.Vector2=Vector2,exports.keyMap=keyMap,exports.InputManager=InputManager,exports.ImageLoader=ImageLoader,exports.StaticObject=StaticObject,exports.DynamicObject=DynamicObject,exports.PhysicsObject=PhysicsObject,exports.SpriteParticle=SpriteParticle,exports.Renderer=Renderer,exports.RenderLayer=RenderLayer,exports.bodies=bodies,exports.time=time,exports.vw=vw,exports.vh=vh,exports.cw=cw,exports.ch=ch,exports.updateTasks=updateTasks,exports.fixedUpdateTasks=fixedUpdateTasks,exports.lateUpdateTasks=lateUpdateTasks,exports.startCoreUpdate=coreUpdate,exports.stopCoreUpdate=stopCoreUpdate;
//# sourceMappingURL=retron.cjs.min.js.map
